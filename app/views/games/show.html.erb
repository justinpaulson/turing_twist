<%= turbo_stream_from @game %>

<% if @game.waiting? %>
  <div style="max-width: 800px; margin: 0 auto;">
    <!-- Top Navigation and Status -->
    <div style="display: flex; align-items: stretch; justify-content: space-between; margin-bottom: 2rem; gap: 1rem;">
      <%= link_to "← BACK", games_path, class: "btn", style: "display: flex; align-items: center; justify-content: center; font-size: 1rem; padding: 0.75rem 1rem; white-space: nowrap;" %>

      <% if @game.can_start? && @current_player&.is_host %>
        <%= link_to "START GAME", start_game_path(@game), data: { turbo_method: :post }, class: "btn", style: "display: flex; align-items: center; justify-content: center; font-size: 1rem; padding: 0.75rem 1.5rem; white-space: nowrap;" %>
      <% elsif @current_player && !@current_player.is_host %>
        <div class="box" style="display: flex; align-items: center; justify-content: center; padding: 0.75rem 1rem; font-family: 'Courier New', monospace; font-size: 0.9rem; white-space: nowrap;">
          ⏳ WAITING...
        </div>
      <% else %>
        <!-- Spacer for alignment when neither condition is met -->
        <div style="min-width: 120px;"></div>
      <% end %>
    </div>

    <!-- Character Assignment Display -->
    <% if @current_player %>
      <div class="box" style="margin-bottom: 2rem; padding: 0; overflow: hidden;">
        <div style="display: flex; flex-direction: column; align-items: stretch;">
          <!-- Character Avatar (Top on mobile, Left on desktop) -->
          <div style="background: #000000; display: flex; align-items: center; justify-content: center; padding: 1.5rem;">
            <%= image_tag @current_player.character_avatar_path, style: "width: 100%; height: auto; max-width: 200px; display: block;" %>
          </div>

          <!-- Character Name (Bottom on mobile, Right on desktop) -->
          <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem; background: #ffffff;">
            <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 0.75rem; color: #333333;">
              ► YOU ARE
            </div>
            <div style="font-size: clamp(1.5rem, 8vw, 3.5rem); font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; line-height: 1.2; text-align: center; margin-bottom: 1rem; word-break: break-word; max-width: 100%;">
              <%= @current_player.character_name %>
            </div>
            <div class="box" style="background: #000000; color: #ffffff; text-align: center; padding: 1rem; width: 100%; max-width: 300px;">
              <div style="font-family: 'Courier New', monospace; font-size: 1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.1em;">
                ■ IN THIS GAME
              </div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="box" style="border: 4px dashed #333333; text-align: center; padding: 2rem; margin-bottom: 2rem;">
        <div style="font-family: 'Courier New', monospace; font-size: 1.2rem; margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
          ▶ YOU ARE VIEWING AS A SPECTATOR
        </div>
        <% if @game.private? && params[:password].present? %>
          <%= form_with url: join_game_path(@game), method: :post, local: true, style: "display: inline;" do |f| %>
            <%= f.hidden_field :password, value: params[:password] %>
            <%= f.submit "JOIN THIS GAME", class: "btn", style: "font-size: 1.3rem; padding: 1rem 3rem;" %>
          <% end %>
        <% else %>
          <%= link_to "JOIN THIS GAME", join_game_path(@game), data: { turbo_method: :post }, class: "btn", style: "font-size: 1.3rem; padding: 1rem 3rem;" %>
        <% end %>
      </div>
    <% end %>

    <!-- Player Count -->
    <div class="box" style="text-align: center; padding: 2rem 1rem;">
      <div style="font-family: 'Courier New', monospace; font-size: clamp(2.5rem, 12vw, 5rem); font-weight: bold; margin-bottom: 1rem; letter-spacing: 0.05em; white-space: nowrap;">
        <%= @game.players.count %> / <%= Game::MAX_PLAYERS %>
      </div>
      <div style="font-size: clamp(1rem, 3vw, 1.5rem); text-transform: uppercase; letter-spacing: 0.1em;">
        PLAYERS JOINED
      </div>
      <hr class="separator">
      <% if @game.players.count < Game::MIN_PLAYERS %>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.9rem, 2.5vw, 1.2rem); margin-top: 1.5rem;">
          ▶ NEED <%= Game::MIN_PLAYERS - @game.players.count %> MORE TO START
        </div>
      <% else %>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.9rem, 2.5vw, 1.2rem); margin-top: 1.5rem;">
          ■ READY TO START!
        </div>
      <% end %>
    </div>

    <!-- How to Play -->
    <div class="box">
      <div class="box-header">
        ► HOW TO PLAY
      </div>

      <div style="display: grid; gap: 2rem;">
        <!-- Step 1 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">1</div>
          <div style="flex: 1;">
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase;">Answer 5 Questions</h4>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">Everyone (including <%= Game::AI_PLAYERS_COUNT %> hidden AI players) answers 5 personal questions. Try to sound human, or try to fool others into thinking you are AI!</p>
          </div>
        </div>

        <!-- Step 2 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">2</div>
          <div style="flex: 1;">
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase;">Vote for 2 AIs</h4>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">After all questions, review everyone's answers and vote for who you think the 2 AI players are.</p>
          </div>
        </div>

        <!-- Step 3 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">3</div>
          <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <h4 style="margin: 0; font-size: 1.3rem; text-transform: uppercase;">Score Points</h4>
              <div style="position: relative; display: inline-block;">
                <span class="info-tooltip-trigger" style="cursor: help; background: #000000; color: #ffffff; border: 2px solid #000000; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-family: 'Courier New', monospace; font-size: 0.9rem; font-weight: bold;">i</span>
                <div class="info-tooltip-content" style="display: none; position: absolute; left: 30px; top: -10px; background: #000000; color: #ffffff; border: 3px solid #000000; padding: 1rem; min-width: 300px; z-index: 1000; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.6;">
                  <div style="margin-bottom: 0.75rem;">
                    <strong style="text-transform: uppercase;">5-6 PLAYERS:</strong><br>
                    • Correct AI guess: <strong>2 points</strong> (4 points total possible)<br>
                    • Each player who votes for you as AI: <strong>1 point</strong>
                  </div>
                  <div>
                    <strong style="text-transform: uppercase;">7-8 PLAYERS:</strong><br>
                    • Correct AI guess: <strong>3 points</strong> (6 points total possible)<br>
                    • Each player who votes for you as AI: <strong>1 point</strong>
                  </div>
                </div>
              </div>
            </div>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">Earn points for correctly identifying AIs and by fooling other players into voting for you.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Win Conditions -->
    <div class="box">
      <div class="box-header">
        ★ HOW TO WIN
      </div>
      <div style="text-align: center; padding: 2rem;">
        <div style="margin-bottom: 1.5rem; display: flex; justify-content: center;">
          <%= image_tag "trophy.svg", style: "width: 120px; height: 120px; border: 4px solid #000000;" %>
        </div>
        <div style="font-weight: bold; font-size: 1.5rem; margin-bottom: 0.5rem; text-transform: uppercase;">Highest Score Wins!</div>
        <div style="font-family: 'Courier New', monospace; font-size: 1.1rem; line-height: 1.8;">
          After 5 rounds of questions and voting,<br>
          the player with the most points is the winner!
        </div>
      </div>
    </div>

    <!-- Host Controls -->
    <% if @current_player&.is_host %>
      <div class="box" style="background: #000000; color: #ffffff; padding: 2rem; margin-bottom: 2rem;">
        <div class="box-header" style="background: #ffffff; color: #000000; margin: -2rem -2rem 1.5rem -2rem; padding: 1rem 2rem;">
          ★ HOST CONTROLS
        </div>

        <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
          <input type="text" id="game-link" value="<%= @game.private? ? game_url(@game, password: @game.password) : game_url(@game) %>" readonly style="flex: 1; padding: 0.75rem; border: 3px solid #ffffff; background: #ffffff; color: #000000; font-family: 'Courier New', monospace; font-size: 1rem;">
          <button id="copy-link-btn" class="btn" style="white-space: nowrap; background: #ffffff; color: #000000; border: 3px solid #ffffff;">
            COPY LINK
          </button>
        </div>

        <% if @game.private? %>
          <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; padding: 1rem; background: rgba(255,255,255,0.1); border: 2px solid #ffffff; display: flex; align-items: center; gap: 0.75rem;">
            <%= image_tag "lock.svg", style: "width: 24px; height: 24px; flex-shrink: 0; filter: invert(1);" %>
            <div>
              <strong>PRIVATE GAME</strong><br>
              Password: <strong><%= @game.password %></strong>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <script>
      function initializeWaitingPageFeatures() {
        // Tooltip functionality
        const triggers = document.querySelectorAll('.info-tooltip-trigger');

        triggers.forEach(trigger => {
          const tooltip = trigger.nextElementSibling;

          trigger.addEventListener('mouseenter', function() {
            tooltip.style.display = 'block';
          });

          trigger.addEventListener('mouseleave', function() {
            tooltip.style.display = 'none';
          });

          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
          });
        });

        // Copy link functionality
        const copyBtn = document.getElementById('copy-link-btn');
        if (copyBtn) {
          copyBtn.addEventListener('click', function() {
            const linkInput = document.getElementById('game-link');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices

            navigator.clipboard.writeText(linkInput.value).then(function() {
              // Change button text temporarily
              const originalText = copyBtn.textContent;
              copyBtn.textContent = '✓ COPIED!';
              copyBtn.style.background = '#000000';
              copyBtn.style.color = '#ffffff';

              setTimeout(function() {
                copyBtn.textContent = originalText;
                copyBtn.style.background = '#ffffff';
                copyBtn.style.color = '#000000';
              }, 2000);
            }).catch(function(err) {
              console.error('Failed to copy: ', err);
            });
          });
        }
      }

      // Support both regular page loads and Turbo navigation
      document.addEventListener('DOMContentLoaded', initializeWaitingPageFeatures);
      document.addEventListener('turbo:load', initializeWaitingPageFeatures);
    </script>
  </div>

<% elsif @game.active? && @current_round %>

  <% if @current_round.answering? %>
    <h3>Round <%= @current_round.round_number %>: Answer Phase</h3>

    <div style="background: white; padding: 1.5rem; border: 2px solid #007bff; border-radius: 8px; margin-bottom: 2rem;">
      <h4>Question:</h4>
      <p style="font-size: 1.2rem;"><%= @current_round.question %></p>
    </div>

    <% if @current_player && !@current_player.is_eliminated? %>
      <% if @my_answer %>
        <p style="color: #28a745;">✓ You have submitted your answer. Waiting for other players...</p>
      <% else %>
        <%= form_with url: submit_answer_game_round_path(@game, @current_round), local: true do |f| %>
          <div style="margin-bottom: 1rem;">
            <%= f.text_area :content, rows: 4, style: "width: 100%; padding: 0.5rem;", placeholder: "Type your answer here...", required: true %>
          </div>
          <%= f.submit "Submit Answer", style: "background: #007bff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer;" %>
        <% end %>
      <% end %>
    <% elsif @current_player&.is_eliminated? %>
      <p style="color: #dc3545;">You have been eliminated but can watch the rest of the game.</p>
    <% end %>

  <% elsif @current_round.voting? %>
    <h3>Round <%= @current_round.round_number %>: Voting Phase</h3>

    <p>Read all the answers and vote for who you think is the AI!</p>

    <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
      <% @answers.each_with_index do |answer, index| %>
        <div style="background: white; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
          <h4>Player <%= index + 1 %></h4>
          <p><%= answer.content %></p>

          <% if @current_player && !@current_player.is_eliminated? && !@my_vote && answer.player != @current_player %>
            <%= form_with url: game_round_votes_path(@game, @current_round), local: true do |f| %>
              <%= f.hidden_field :voted_for_id, value: answer.player_id %>
              <%= f.submit "Vote for this player", style: "background: #dc3545; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;" %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if @my_vote %>
      <p style="color: #28a745;">✓ You have voted. Waiting for other players...</p>
    <% end %>

  <% end %>

<% elsif @game.completed? %>
  <div style="max-width: 1200px; margin: 0 auto;">
    <h2 style="text-align: center; margin-bottom: 3rem; text-transform: uppercase; font-size: 3rem;">GAME OVER!</h2>

    <!-- Winner/Final Leaderboard -->
    <div class="box" style="background: #000000; color: #ffffff; padding: 2rem; margin-bottom: 2rem;">
      <div style="font-family: 'Courier New', monospace; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 2rem; text-align: center;">
        ★ FINAL LEADERBOARD ★
      </div>

      <!-- Column Headers -->
      <div style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px 100px; gap: 1rem; padding: 1rem 1.5rem; border-bottom: 3px solid #ffffff; margin-bottom: 1rem;">
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">RANK</div>
        <div></div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;">PLAYER</div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">AIS FOUND</div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">VOTES RCV'D</div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">SCORE</div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">STATUS</div>
      </div>

      <!-- Human Player Rows -->
      <div style="display: grid; gap: 0.5rem;">
        <% @game.players.where(is_ai: false).order(score: :desc).each_with_index do |player, index| %>
          <% stats = @player_stats[player.id] || {} %>
          <div class="box" style="background: <%= index == 0 ? '#FFD700' : '#ffffff' %>; color: #000000; padding: 1.5rem; border: 4px solid <%= index == 0 ? '#FFD700' : '#cccccc' %>;">
            <div style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px 100px; gap: 1rem; align-items: center;">

              <!-- Rank -->
              <div style="font-size: 2rem; font-weight: bold; text-align: center; font-family: 'Courier New', monospace;">
                <% if index == 0 %>
                  <%= image_tag "trophy.svg", style: "width: 50px; height: 50px; border: 3px solid #000000;" %>
                <% else %>
                  <%= index + 1 %>
                <% end %>
              </div>

              <!-- Avatar -->
              <div style="width: 70px; height: 70px; background: #000000; border: 3px solid #000000; display: flex; align-items: center; justify-content: center; padding: 0.4rem;">
                <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
              </div>

              <!-- Player Name -->
              <div>
                <div style="font-size: 1.4rem; font-weight: bold; text-transform: uppercase; font-family: 'Courier New', monospace; letter-spacing: 0.05em; margin-bottom: 0.25rem;">
                  <%= player.character_name %>
                </div>
                <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; opacity: 0.7;">
                  ■ HUMAN PLAYER
                </div>
              </div>

              <!-- AIs Found (X/2) -->
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  <%= stats[:correct_votes] || 0 %>/2
                </div>
                <div style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.7; margin-top: 0.25rem;">
                  +<%= stats[:points_from_guesses] || 0 %> pts
                </div>
              </div>

              <!-- Votes Received -->
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  <%= stats[:votes_received] || 0 %>
                </div>
                <div style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.7; margin-top: 0.25rem;">
                  +<%= stats[:points_from_deception] || 0 %> pts
                </div>
              </div>

              <!-- Total Score -->
              <div style="text-align: center; background: #000000; color: <%= index == 0 ? '#FFD700' : '#ffffff' %>; padding: 1rem; border: 3px solid #000000;">
                <div style="font-size: 2.5rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  <%= player.score || 0 %>
                </div>
                <div style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.8; margin-top: 0.25rem;">
                  POINTS
                </div>
              </div>

              <!-- Status Badge -->
              <div style="text-align: center;">
                <% if index == 0 %>
                  <div style="background: #FFD700; color: #000000; padding: 0.5rem; font-family: 'Courier New', monospace; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; border: 3px solid #000000;">
                    WINNER
                  </div>
                <% else %>
                  <div style="background: #ffffff; color: #000000; padding: 0.5rem; font-family: 'Courier New', monospace; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; border: 3px solid #000000;">
                    HUMAN
                  </div>
                <% end %>
              </div>

            </div>
          </div>
        <% end %>

        <!-- AI Player Rows (no rank or points) -->
        <% @game.players.where(is_ai: true).each do |player| %>
          <% stats = @player_stats[player.id] || {} %>
          <div class="box" style="background: #cccccc; color: #000000; padding: 1.5rem; border: 4px solid #999999;">
            <div style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px 100px; gap: 1rem; align-items: center;">

              <!-- No Rank (just dash) -->
              <div style="font-size: 2rem; font-weight: bold; text-align: center; font-family: 'Courier New', monospace; opacity: 0.5;">
                —
              </div>

              <!-- Avatar -->
              <div style="width: 70px; height: 70px; background: #000000; border: 3px solid #000000; display: flex; align-items: center; justify-content: center; padding: 0.4rem;">
                <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
              </div>

              <!-- Player Name -->
              <div>
                <div style="font-size: 1.4rem; font-weight: bold; text-transform: uppercase; font-family: 'Courier New', monospace; letter-spacing: 0.05em; margin-bottom: 0.25rem;">
                  <%= player.character_name %>
                </div>
                <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; opacity: 0.7;">
                  ■ AI PLAYER
                </div>
              </div>

              <!-- AIs Found (N/A for AIs) -->
              <div style="text-align: center; opacity: 0.5;">
                <div style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  —
                </div>
              </div>

              <!-- Votes Received -->
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  <%= stats[:votes_received] || 0 %>
                </div>
              </div>

              <!-- No Score -->
              <div style="text-align: center; opacity: 0.5;">
                <div style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                  —
                </div>
              </div>

              <!-- Status Badge -->
              <div style="text-align: center;">
                <div style="background: #000000; color: #ffffff; padding: 0.5rem; font-family: 'Courier New', monospace; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; border: 3px solid #000000;">
                  AI
                </div>
              </div>

            </div>
          </div>
        <% end %>
      </div>

      <!-- Scoring Legend -->
      <div style="margin-top: 2rem; padding: 1.5rem; border: 3px solid #ffffff; background: rgba(255,255,255,0.1);">
        <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; opacity: 0.8;">
          ► SCORING BREAKDOWN:
        </div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.8;">
          • Each correct AI identification: <strong>+<%= @game.points_per_correct_guess %> points</strong> (max <%= @game.max_points_from_guesses %> points)<br>
          • Each vote received as AI (humans only): <strong>+1 point</strong> (fooled other players!)<br>
          • AIs Found: Shows how many of the 2 AI players you correctly identified
        </div>
      </div>
    </div>

    <!-- The Reveal: All Characters -->
    <div class="box" style="padding: 2rem; margin-bottom: 2rem;">
      <div class="box-header" style="text-align: center; margin-bottom: 2rem;">
        ► THE REVEAL ◄
      </div>

      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
        <% @game.players.where(is_ai: false).each do |player| %>
          <div class="box" style="background: #ffffff; padding: 1.5rem; text-align: center;">
            <div style="width: 100px; height: 100px; background: #000000; border: 3px solid #000000; display: flex; align-items: center; justify-content: center; padding: 0.5rem; margin: 0 auto 1rem;">
              <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
            </div>
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase; font-family: 'Courier New', monospace;"><%= player.character_name %></h4>
            <div style="font-family: 'Courier New', monospace; font-size: 1.1rem; padding: 0.5rem; background: #000000; color: #ffffff; font-weight: bold; text-transform: uppercase;">
              ■ HUMAN
            </div>
          </div>
        <% end %>

        <% @game.players.where(is_ai: true).each do |player| %>
          <div class="box" style="background: #000000; color: #ffffff; padding: 1.5rem; text-align: center;">
            <div style="width: 100px; height: 100px; background: #ffffff; border: 3px solid #ffffff; display: flex; align-items: center; justify-content: center; padding: 0.5rem; margin: 0 auto 1rem;">
              <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
            </div>
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase; font-family: 'Courier New', monospace;"><%= player.character_name %></h4>
            <div style="font-family: 'Courier New', monospace; font-size: 1.1rem; padding: 0.5rem; background: #ffffff; color: #000000; font-weight: bold; text-transform: uppercase; border: 2px solid #ffffff;">
              ■ AI
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <%= link_to "← BACK TO GAMES", games_path, class: "btn", style: "display: block; width: fit-content; margin: 2rem auto 0;" %>
  </div>
<% end %>
