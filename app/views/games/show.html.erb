<%= turbo_stream_from @game %>

<style>
  @media (max-width: 768px) {
    /* Final Leaderboard - Compact horizontal rows on mobile */
    .leaderboard-header {
      grid-template-columns: 30px 40px 1fr 45px 45px 55px !important;
      gap: 0.25rem !important;
      padding: 0.5rem 0.3rem !important;
      margin-bottom: 0.5rem !important;
      border-bottom-width: 2px !important;
    }

    .leaderboard-header > div {
      font-size: 0.5rem !important;
      letter-spacing: 0.02em !important;
    }

    /* Show short headers on mobile, hide full headers */
    .header-full {
      display: none !important;
    }

    .header-short {
      display: inline !important;
    }

    .leaderboard-row {
      grid-template-columns: 30px 40px 1fr 45px 45px 55px !important;
      gap: 0.25rem !important;
      padding: 0.5rem 0.3rem !important;
    }

    /* Keep stat labels hidden on mobile, but show player type */
    .stat-label {
      display: none !important;
    }

    /* Individual cell sizing */
    .rank-cell {
      font-size: 1.2rem !important;
    }

    .trophy-icon {
      width: 30px !important;
      height: 30px !important;
      border-width: 2px !important;
    }

    .avatar-cell {
      width: 40px !important;
      height: 40px !important;
      padding: 0.2rem !important;
      border-width: 2px !important;
    }

    .player-name {
      font-size: 0.7rem !important;
      letter-spacing: 0.02em !important;
      margin-bottom: 0 !important;
      line-height: 1.2 !important;
    }

    .stat-number {
      font-size: 1rem !important;
    }

    .score-cell {
      padding: 0.4rem 0.2rem !important;
      border-width: 2px !important;
    }

    .score-number {
      font-size: 1.4rem !important;
    }

    /* Player box padding */
    .leaderboard-row + .leaderboard-row,
    .box:has(.leaderboard-row) {
      padding: 0.5rem 0.3rem !important;
      border-width: 3px !important;
    }

    /* Email subrow on mobile */
    .player-email-subrow {
      margin-top: 0.5rem !important;
      padding: 0.3rem 0.5rem !important;
      font-size: 0.7rem !important;
    }

    /* Reveal section - single column and reduced padding */
    .reveal-grid {
      grid-template-columns: 1fr !important;
      gap: 1rem !important;
    }

    .reveal-box {
      padding: 1rem !important;
    }

    .reveal-container {
      padding: 1rem !important;
    }

    /* Game Over heading */
    .game-over-heading {
      font-size: 2rem !important;
      margin-bottom: 1.5rem !important;
    }

    /* Leaderboard container */
    .final-leaderboard-box {
      padding: 1rem !important;
    }

    .leaderboard-title {
      font-size: 1.2rem !important;
      margin-bottom: 1rem !important;
    }

    .scoring-legend {
      padding: 1rem !important;
      font-size: 0.8rem !important;
    }

    /* Main container padding */
    .game-results-container {
      padding: 0 0.5rem !important;
    }
  }
</style>

<% if @game.waiting? %>
  <div style="max-width: 800px; margin: 0 auto;">
    <!-- Top Navigation and Status -->
    <div style="display: flex; align-items: stretch; justify-content: space-between; margin-bottom: 2rem; gap: 1rem; height: 48px;">
      <%= link_to "← BACK", games_path, class: "btn", style: "display: flex; align-items: center; justify-content: center; font-size: 1rem; white-space: nowrap;" %>

      <% if @game.can_start? && @current_player&.is_host %>
        <%= link_to "START GAME", start_game_path(@game), data: { turbo_method: :post }, class: "btn", style: "display: flex; align-items: center; justify-content: center; font-size: 1rem; white-space: nowrap;" %>
      <% end %>
    </div>

    <!-- Character Assignment Display -->
    <% if @current_player %>
      <div class="box" style="margin-bottom: 2rem; padding: 0; overflow: hidden;">
        <div style="display: flex; flex-direction: column; align-items: stretch;">
          <!-- Character Avatar (Top on mobile, Left on desktop) -->
          <div style="background: #000000; display: flex; align-items: center; justify-content: center; padding: 1.5rem;">
            <%= image_tag @current_player.character_avatar_path, style: "width: 100%; height: auto; max-width: 200px; display: block;" %>
          </div>

          <!-- Character Name (Bottom on mobile, Right on desktop) -->
          <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem; background: #ffffff;">
            <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 0.75rem; color: #333333;">
              ► YOU ARE
            </div>
            <div style="font-size: clamp(1.5rem, 8vw, 3.5rem); font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; line-height: 1.2; text-align: center; word-break: break-word; max-width: 100%;">
              <%= @current_player.character_name %>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="box" style="border: 4px dashed #333333; text-align: center; padding: 2rem; margin-bottom: 2rem;">
        <div style="font-family: 'Courier New', monospace; font-size: 1.2rem; margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
          ▶ YOU ARE VIEWING AS A SPECTATOR
        </div>
        <% if @game.private? && params[:password].present? %>
          <%= form_with url: join_game_path(@game), method: :post, local: true, style: "display: inline;" do |f| %>
            <%= f.hidden_field :password, value: params[:password] %>
            <%= f.submit "JOIN THIS GAME", class: "btn", style: "font-size: 1.3rem; padding: 1rem 3rem;" %>
          <% end %>
        <% else %>
          <%= link_to "JOIN THIS GAME", join_game_path(@game), data: { turbo_method: :post }, class: "btn", style: "font-size: 1.3rem; padding: 1rem 3rem;" %>
        <% end %>
      </div>
    <% end %>

    <!-- Player Count -->
    <div class="box" style="text-align: center; padding: 2rem 1rem;">
      <div style="font-family: 'Courier New', monospace; font-size: clamp(2.5rem, 12vw, 5rem); font-weight: bold; margin-bottom: 1rem; letter-spacing: 0.05em; white-space: nowrap;">
        <%= @game.players.count %> / <%= Game::MAX_PLAYERS %>
      </div>
      <div style="font-size: clamp(1rem, 3vw, 1.5rem); text-transform: uppercase; letter-spacing: 0.1em;">
        PLAYERS JOINED
      </div>
      <hr class="separator">
      <% if @game.players.count < Game::MIN_PLAYERS %>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.9rem, 2.5vw, 1.2rem); margin-top: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
          <%= image_tag "hourglass.svg", style: "width: 20px; height: 20px;" %>
          WAITING FOR PLAYERS
        </div>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.8rem, 2vw, 1rem); margin-top: 0.75rem; opacity: 0.7;">
          ▶ NEED <%= Game::MIN_PLAYERS - @game.players.count %> MORE
        </div>
      <% elsif @current_player&.is_host %>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.9rem, 2.5vw, 1.2rem); margin-top: 1.5rem;">
          ■ READY TO START!
        </div>
      <% else %>
        <div style="font-family: 'Courier New', monospace; font-size: clamp(0.9rem, 2.5vw, 1.2rem); margin-top: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
          <%= image_tag "hourglass.svg", style: "width: 20px; height: 20px;" %>
          WAITING FOR HOST TO START
        </div>
      <% end %>
    </div>

    <!-- How to Play -->
    <div class="box">
      <div class="box-header">
        ► HOW TO PLAY
      </div>

      <div style="display: grid; gap: 2rem;">
        <!-- Step 1 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">1</div>
          <div style="flex: 1;">
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase;">Answer 5 Questions</h4>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">Everyone (including <%= Game::AI_PLAYERS_COUNT %> hidden AI players) answers 5 personal questions. Try to sound human, or try to fool others into thinking you are AI!</p>
          </div>
        </div>

        <!-- Step 2 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">2</div>
          <div style="flex: 1;">
            <h4 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; text-transform: uppercase;">Vote for 2 AIs</h4>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">After all questions, review everyone's answers and vote for who you think the 2 AI players are.</p>
          </div>
        </div>

        <!-- Step 3 -->
        <div style="display: flex; gap: 1.5rem; align-items: start;">
          <div style="background: #000000; color: #ffffff; border: 4px solid #000000; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;">3</div>
          <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <h4 style="margin: 0; font-size: 1.3rem; text-transform: uppercase;">Score Points</h4>
              <div style="position: relative; display: inline-block;">
                <span class="info-tooltip-trigger" style="cursor: help; background: #000000; color: #ffffff; border: 2px solid #000000; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-family: 'Courier New', monospace; font-size: 0.9rem; font-weight: bold;">i</span>
                <div class="info-tooltip-content" style="display: none; position: absolute; left: 30px; top: -10px; background: #000000; color: #ffffff; border: 3px solid #000000; padding: 1rem; min-width: 300px; z-index: 1000; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.6;">
                  <div style="margin-bottom: 0.75rem;">
                    <strong style="text-transform: uppercase;">5-6 PLAYERS:</strong><br>
                    • Correct AI guess: <strong>2 points</strong> (4 points total possible)<br>
                    • Each player who votes for you as AI: <strong>1 point</strong>
                  </div>
                  <div>
                    <strong style="text-transform: uppercase;">7-8 PLAYERS:</strong><br>
                    • Correct AI guess: <strong>3 points</strong> (6 points total possible)<br>
                    • Each player who votes for you as AI: <strong>1 point</strong>
                  </div>
                </div>
              </div>
            </div>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 1rem;">Earn points for correctly identifying AIs and by fooling other players into voting for you.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Win Conditions -->
    <div class="box">
      <div class="box-header">
        ★ HOW TO WIN
      </div>
      <div style="text-align: center; padding: 2rem;">
        <div style="margin-bottom: 1.5rem; display: flex; justify-content: center;">
          <%= image_tag "trophy.svg", style: "width: 120px; height: 120px; border: 4px solid #000000;" %>
        </div>
        <div style="font-weight: bold; font-size: 1.5rem; margin-bottom: 0.5rem; text-transform: uppercase;">Highest Score Wins!</div>
        <div style="font-family: 'Courier New', monospace; font-size: 1.1rem; line-height: 1.8;">
          After 5 rounds of questions and voting,<br>
          the player with the most points is the winner!
        </div>
      </div>
    </div>

    <!-- Host Controls -->
    <% if @current_player&.is_host %>
      <div class="box" style="background: #000000; color: #ffffff; padding: 2rem; margin-bottom: 2rem;">
        <div class="box-header" style="background: #ffffff; color: #000000; margin: -2rem -2rem 1.5rem -2rem; padding: 1rem 2rem;">
          ★ HOST CONTROLS
        </div>

        <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
          <input type="text" id="game-link" value="<%= @game.private? ? game_url(@game, password: @game.password) : game_url(@game) %>" readonly style="flex: 1; padding: 0.75rem; border: 3px solid #ffffff; background: #ffffff; color: #000000; font-family: 'Courier New', monospace; font-size: 1rem;">
          <button id="copy-link-btn" class="btn" style="white-space: nowrap; background: #ffffff; color: #000000; border: 3px solid #ffffff;">
            COPY LINK
          </button>
        </div>

        <% if @game.private? %>
          <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; padding: 1rem; background: rgba(255,255,255,0.1); border: 2px solid #ffffff; display: flex; align-items: center; gap: 0.75rem;">
            <%= image_tag "lock.svg", style: "width: 24px; height: 24px; flex-shrink: 0; filter: invert(1);" %>
            <div>
              <strong>PRIVATE GAME</strong><br>
              Password: <strong><%= @game.password %></strong>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <script>
      function initializeWaitingPageFeatures() {
        // Tooltip functionality
        const triggers = document.querySelectorAll('.info-tooltip-trigger');

        triggers.forEach(trigger => {
          const tooltip = trigger.nextElementSibling;

          trigger.addEventListener('mouseenter', function() {
            tooltip.style.display = 'block';
          });

          trigger.addEventListener('mouseleave', function() {
            tooltip.style.display = 'none';
          });

          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
          });
        });

        // Copy link functionality
        const copyBtn = document.getElementById('copy-link-btn');
        if (copyBtn) {
          copyBtn.addEventListener('click', function() {
            const linkInput = document.getElementById('game-link');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices

            navigator.clipboard.writeText(linkInput.value).then(function() {
              // Change button text temporarily
              const originalText = copyBtn.textContent;
              copyBtn.textContent = '✓ COPIED!';
              copyBtn.style.background = '#000000';
              copyBtn.style.color = '#ffffff';

              setTimeout(function() {
                copyBtn.textContent = originalText;
                copyBtn.style.background = '#ffffff';
                copyBtn.style.color = '#000000';
              }, 2000);
            }).catch(function(err) {
              console.error('Failed to copy: ', err);
            });
          });
        }
      }

      // Support both regular page loads and Turbo navigation
      document.addEventListener('DOMContentLoaded', initializeWaitingPageFeatures);
      document.addEventListener('turbo:load', initializeWaitingPageFeatures);
    </script>
  </div>

<% elsif @game.active? && @current_round %>

  <% if @current_round.answering? %>
    <h3>Round <%= @current_round.round_number %>: Answer Phase</h3>

    <div style="background: white; padding: 1.5rem; border: 2px solid #007bff; border-radius: 8px; margin-bottom: 2rem;">
      <h4>Question:</h4>
      <p style="font-size: 1.2rem;"><%= @current_round.question %></p>
    </div>

    <% if @current_player && !@current_player.is_eliminated? %>
      <% if @my_answer %>
        <p style="color: #28a745;">✓ You have submitted your answer. Waiting for other players...</p>
      <% else %>
        <%= form_with url: submit_answer_game_round_path(@game, @current_round), local: true do |f| %>
          <div style="margin-bottom: 1rem;">
            <%= f.text_area :content, rows: 4, style: "width: 100%; padding: 0.5rem;", placeholder: "Type your answer here...", required: true %>
          </div>
          <%= f.submit "Submit Answer", style: "background: #007bff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer;" %>
        <% end %>
      <% end %>
    <% elsif @current_player&.is_eliminated? %>
      <p style="color: #dc3545;">You have been eliminated but can watch the rest of the game.</p>
    <% end %>

  <% elsif @current_round.voting? %>
    <h3>Round <%= @current_round.round_number %>: Voting Phase</h3>

    <p>Read all the answers and vote for who you think is the AI!</p>

    <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
      <% @answers.each_with_index do |answer, index| %>
        <div style="background: white; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
          <h4>Player <%= index + 1 %></h4>
          <p><%= answer.content %></p>

          <% if @current_player && !@current_player.is_eliminated? && !@my_vote && answer.player != @current_player %>
            <%= form_with url: game_round_votes_path(@game, @current_round), local: true do |f| %>
              <%= f.hidden_field :voted_for_id, value: answer.player_id %>
              <%= f.submit "Vote for this player", style: "background: #dc3545; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;" %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if @my_vote %>
      <p style="color: #28a745;">✓ You have voted. Waiting for other players...</p>
    <% end %>

  <% end %>

<% elsif @game.completed? %>
  <div class="game-results-container" style="max-width: 1200px; margin: 0 auto;">
    <h2 class="game-over-heading" style="text-align: center; margin-bottom: 3rem; text-transform: uppercase; font-size: 3rem;">GAME OVER!</h2>

    <!-- Winner/Final Leaderboard -->
    <div class="box final-leaderboard-box" style="background: #000000; color: #ffffff; padding: 2rem; margin-bottom: 2rem;">
      <div class="leaderboard-title" style="font-family: 'Courier New', monospace; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 2rem; text-align: center;">
        ★ FINAL LEADERBOARD ★
      </div>

      <!-- Column Headers -->
      <div class="leaderboard-header" style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px; gap: 1rem; padding: 1rem 1.5rem; border-bottom: 3px solid #ffffff; margin-bottom: 1rem;">
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;"><span class="header-full">RANK</span><span class="header-short" style="display: none;">RK</span></div>
        <div></div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;"><span class="header-full">PLAYER</span><span class="header-short" style="display: none;">NAME</span></div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;"><span class="header-full">AIS FOUND</span><span class="header-short" style="display: none;">AIs</span></div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;"><span class="header-full">VOTES RCV'D</span><span class="header-short" style="display: none;">VOTES</span></div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;"><span class="header-full">SCORE</span><span class="header-short" style="display: none;">PTS</span></div>
      </div>

      <!-- Human Player Rows -->
      <div style="display: grid; gap: 0.5rem;">
        <% @game.players.where(is_ai: false).order(score: :desc).each_with_index do |player, index| %>
          <% stats = @player_stats[player.id] || {} %>
          <div class="box" style="background: <%= index == 0 ? '#FFD700' : '#ffffff' %>; color: #000000; padding: 1.5rem; border: 4px solid <%= index == 0 ? '#FFD700' : '#cccccc' %>;">
            <!-- Main Stats Row -->
            <div class="leaderboard-row" style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px; gap: 1rem; align-items: center;">

              <!-- Rank + Avatar + Name (grouped for mobile) -->
              <div style="display: contents;">
                <!-- Rank -->
                <div class="rank-cell" style="font-size: 2rem; font-weight: bold; text-align: center; font-family: 'Courier New', monospace;">
                  <% if index == 0 %>
                    <%= image_tag "trophy.svg", class: "trophy-icon", style: "width: 50px; height: 50px; border: 3px solid #000000;" %>
                  <% else %>
                    <%= index + 1 %>
                  <% end %>
                </div>

                <!-- Avatar -->
                <div class="avatar-cell" style="width: 70px; height: 70px; background: #000000; border: 3px solid #000000; display: flex; align-items: center; justify-content: center; padding: 0.4rem;">
                  <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
                </div>

                <!-- Player Name -->
                <div class="name-cell">
                  <div class="player-name" style="font-size: 1.4rem; font-weight: bold; text-transform: uppercase; font-family: 'Courier New', monospace; letter-spacing: 0.05em;">
                    <%= player.character_name %>
                  </div>
                </div>
              </div>

              <!-- Stats -->
              <div style="display: contents;">
                <!-- AIs Found (X/2) -->
                <div class="stat-cell" style="text-align: center;">
                  <div class="stat-number" style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    <%= stats[:correct_votes] || 0 %>/2
                  </div>
                  <div class="stat-label" style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.7; margin-top: 0.25rem;">
                    +<%= stats[:points_from_guesses] || 0 %> pts
                  </div>
                </div>

                <!-- Votes Received -->
                <div class="stat-cell" style="text-align: center;">
                  <div class="stat-number" style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    <%= stats[:votes_received] || 0 %>
                  </div>
                  <div class="stat-label" style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.7; margin-top: 0.25rem;">
                    +<%= stats[:points_from_deception] || 0 %> pts
                  </div>
                </div>
              </div>

              <!-- Score + Status -->
              <div style="display: contents;">
                <!-- Total Score -->
                <div class="score-cell" style="text-align: center; background: #000000; color: <%= index == 0 ? '#FFD700' : '#ffffff' %>; padding: 1rem; border: 3px solid #000000;">
                  <div class="score-number" style="font-size: 2.5rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    <%= player.score || 0 %>
                  </div>
                  <div class="stat-label" style="font-family: 'Courier New', monospace; font-size: 0.7rem; text-transform: uppercase; opacity: 0.8; margin-top: 0.25rem;">
                    POINTS
                  </div>
                </div>
              </div>

            </div>

            <!-- Email Subrow -->
            <div class="player-email-subrow" style="margin-top: 0.75rem; padding: 0.5rem 1rem; background: rgba(0,0,0,0.05); border: 2px solid rgba(0,0,0,0.1);">
              <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; opacity: 0.7;">
                ■ <%= player == @current_player ? "YOU" : player.user&.email_address %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- AI Player Rows (no rank or points) -->
        <% @game.players.where(is_ai: true).each do |player| %>
          <% stats = @player_stats[player.id] || {} %>
          <div class="box" style="background: #cccccc; color: #000000; padding: 1.5rem; border: 4px solid #999999;">
            <!-- Main Stats Row -->
            <div class="leaderboard-row" style="display: grid; grid-template-columns: 60px 80px 1fr 120px 120px 120px; gap: 1rem; align-items: center;">

              <!-- Rank + Avatar + Name -->
              <div style="display: contents;">
                <!-- No Rank (just dash) -->
                <div class="rank-cell" style="font-size: 2rem; font-weight: bold; text-align: center; font-family: 'Courier New', monospace; opacity: 0.5;">
                  —
                </div>

                <!-- Avatar -->
                <div class="avatar-cell" style="width: 70px; height: 70px; background: #000000; border: 3px solid #000000; display: flex; align-items: center; justify-content: center; padding: 0.4rem;">
                  <%= image_tag player.character_avatar_path, style: "width: 100%; height: 100%; object-fit: contain;" %>
                </div>

                <!-- Player Name -->
                <div class="name-cell">
                  <div class="player-name" style="font-size: 1.4rem; font-weight: bold; text-transform: uppercase; font-family: 'Courier New', monospace; letter-spacing: 0.05em;">
                    <%= player.character_name %>
                  </div>
                </div>
              </div>

              <!-- Stats -->
              <div style="display: contents;">
                <!-- AIs Found (N/A for AIs) -->
                <div class="stat-cell" style="text-align: center; opacity: 0.5;">
                  <div class="stat-number" style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    —
                  </div>
                </div>

                <!-- Votes Received -->
                <div class="stat-cell" style="text-align: center;">
                  <div class="stat-number" style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    <%= stats[:votes_received] || 0 %>
                  </div>
                </div>
              </div>

              <!-- Score + Status -->
              <div style="display: contents;">
                <!-- No Score -->
                <div class="score-cell" style="text-align: center; opacity: 0.5;">
                  <div class="score-number" style="font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace;">
                    —
                  </div>
                </div>
              </div>

            </div>

            <!-- AI Player Type Subrow -->
            <div class="player-email-subrow" style="margin-top: 0.75rem; padding: 0.5rem 1rem; background: rgba(0,0,0,0.1); border: 2px solid rgba(0,0,0,0.2);">
              <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; opacity: 0.7;">
                ■ AI PLAYER
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Scoring Legend -->
      <div class="scoring-legend" style="margin-top: 2rem; padding: 1.5rem; border: 3px solid #ffffff; background: rgba(255,255,255,0.1);">
        <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; opacity: 0.8;">
          ► SCORING BREAKDOWN:
        </div>
        <div style="font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.8;">
          • Correct Vote: <strong>+<%= @game.points_per_correct_guess %> points</strong> (max <%= @game.max_points_from_guesses %> points)<br>
          • Vote received: <strong>+1 points</strong> (fooled other players!)<br>
        </div>
      </div>
    </div>

    <%= link_to "← BACK TO GAMES", games_path, class: "btn", style: "display: block; width: fit-content; margin: 2rem auto 0;" %>
  </div>
<% end %>
